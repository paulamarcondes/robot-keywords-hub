<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Robot Framework Keyword Hub</title>
    <link rel="icon" href="data/robot-logo.png" type="image/png">
    <link rel="stylesheet" href="css/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="data/robot-logo.png" alt="Logo" class="logo-icon">
                <span>Keyword Hub</span>
            </a>

            <div class="nav-links">
                <a href="library.html?lib=Browser">Browser</a>
                <a href="library.html?lib=BuiltIn">BuiltIn</a>
                <a href="library.html?lib=Collections">Collections</a>
                <a href="library.html?lib=Database">Database</a>
                <a href="library.html?lib=DateTime">DateTime</a>
                <a href="library.html?lib=FakerLibrary">Faker</a>
                <a href="library.html?lib=OperatingSystem">OperatingSystem</a>
                <a href="library.html?lib=Process">Process</a>
                <a href="library.html?lib=RequestsLibrary">Requests</a>
                <a href="library.html?lib=Screenshot">Screenshot</a>
                <a href="library.html?lib=SeleniumLibrary">SeleniumLibrary</a>
                <a href="library.html?lib=String">String</a>
                <a href="library.html?lib=XML">XML</a>
                <a href="all-keywords.html" class="highlight"><strong>All Keywords</strong></a>
            </div>
        </div>
    </nav>

    <section class="hero">
        <h1 class="hero-title">Robot Framework Keyword Hub</h1>
        <p class="hero-subtitle">Search any keyword or select a library above</p>

        <div class="search-container">
            <input type="text" id="searchBox" class="search-box" placeholder="Try 'Wait Until' or 'Get Element Attribute'..." />
            <button id="searchButton" class="search-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="white" class="icon">
                    <circle cx="10" cy="10" r="6" stroke="none"></circle>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4l8 8-8 8" />
                </svg>
            </button>
        </div>

        <div class="results" id="results"></div>
    </section>

    <div id="keywordModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close">&times;</span>
            <h2 id="modalTitle" class="modal-title"></h2>
            <p id="modalLibrary" class="modal-library"></p>
            <p id="modalArgsLabel" class="modal-args-label">Required Arguments:</p>
            <p id="modalArgs" class="modal-args"></p>
            <p id="modalDoc" class="modal-doc"></p>
            <div class="modal-buttons">
                <button id="copyKeyword" class="btn">Copy Keyword</button>
                <button id="openDocs" class="btn btn-secondary">Open Official Docs</button>
            </div>
            <div id="toast" class="toast">âœ… Copied!</div>
        </div>
    </div>

    <script>
        let fuse;
        let allKeywords = [];
        const resultsDiv = document.getElementById("results");
        const searchBox = document.getElementById("searchBox");
        const searchButton = document.getElementById("searchButton");
        const modal = document.getElementById("keywordModal");
        const closeModal = document.getElementById("closeModal");

        function getFirstParagraph(html) {
            if (!html) return "No documentation available.";
            
            const matchP = html.match(/<p>(.*?)<\/p>/i);
            if (matchP && matchP[1]) {
                return matchP[1];
            }
            
            const summary = html.split(/\n\s*\n/)[0].trim();
            
            return summary || "No documentation available.";
        }

        fetch('data/keywords.json')
            .then(response => response.json())
            .then(keywords => {
                allKeywords = keywords;
                
                fuse = new Fuse(allKeywords, { 
                    keys: [
                        { name: "name", weight: 0.8 }, 
                        { name: "library", weight: 0.1 }, 
                        { name: "doc", weight: 0.1 }
                    ],
                    threshold: 0.4, 
                    ignoreFieldNorm: true, 
                    location: 0,
                    distance: 1000,
                    tokenize: true,
                    matchAllTokens: false 
                });
            });

        function runSearch(query) {
            const trimmed = query.trim();
            resultsDiv.innerHTML = "";
            if (trimmed.length === 0) {
                resultsDiv.style.display = "none";
                return;
            }
            if (!fuse) return;

            const allResults = fuse.search(trimmed).map(r => r.item);

            const groupedKeywords = allResults.reduce((acc, keyword) => {
                if (!acc[keyword.name]) {
                    acc[keyword.name] = [];
                }
                acc[keyword.name].push(keyword);
                return acc;
            }, {});
            
            const resultsToDisplay = Object.values(groupedKeywords);

            resultsDiv.style.display = "grid";
            
            resultsToDisplay.forEach(group => {
                const keywordName = group[0].name;
                const libraries = group.map(k => k.library).join(", "); 
                
                const div = document.createElement("div");
                div.classList.add("result-card", "fade-in");
                
                div.innerHTML = `
                    <div class="result-title">${keywordName}</div>
                    <div class="result-lib">${libraries}</div>
                `;
                
                div.onclick = () => openModal(group); 
                resultsDiv.appendChild(div);
            });
        }

        searchBox.addEventListener("input", e => runSearch(e.target.value));
        searchButton.addEventListener("click", () => runSearch(searchBox.value));

        function openModal(keywordOrKeywords) {
            let keyword;
            let availableKeywords = [];

            if (Array.isArray(keywordOrKeywords)) {
                keyword = keywordOrKeywords[0];
                availableKeywords = keywordOrKeywords;
            } else {
                keyword = keywordOrKeywords;
                availableKeywords = [keywordOrKeywords];
            }
            
            const modalTitle = document.getElementById("modalTitle");
            const modalLibrary = document.getElementById("modalLibrary");
            const modalArgs = document.getElementById("modalArgs");
            const modalDoc = document.getElementById("modalDoc");
            const openDocsBtn = document.getElementById("openDocs");
            const copyBtn = document.getElementById("copyKeyword");
            const toast = document.getElementById("toast");
            
            modalTitle.innerText = keyword.name;

            if (availableKeywords.length > 1) {
                const libraryList = availableKeywords.map(k => k.library).join(', ');
                modalLibrary.innerText = 'Available in: ' + libraryList;
            } else {
                modalLibrary.innerText = "Library: " + keyword.library;
            }
            
            modalArgs.innerText = (keyword.requiredArgs && keyword.requiredArgs.length) ? keyword.requiredArgs.join(", ") : "None";
            
            modalDoc.innerHTML = getFirstParagraph(keyword.doc);

            openDocsBtn.onclick = () => window.open(keyword.url, "_blank");

            copyBtn.onclick = () => {
                navigator.clipboard.writeText(keyword.name);
                toast.classList.add("show");
                setTimeout(() => toast.classList.remove("show"), 1000);
            };

            modal.style.display = "flex";
        }

        closeModal.onclick = () => (modal.style.display = "none");
        window.onclick = e => {
            if (e.target === modal) modal.style.display = "none";
        };
    </script>
</body>
</html>